(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function M(n){const e=window.devicePixelRatio||1,{clientWidth:t,clientHeight:i}=n,s=n.getContext("2d");return s.setTransform(1,0,0,1,0,0),n.width=Math.floor(t*e),n.height=Math.floor(i*e),s.scale(e,e),{w:t,h:i,dpr:e}}class B{constructor(){this.listeners=new Set,this.watchedCanvases=new Map,this.mediaQuery=null,this.boundTrigger=this.trigger.bind(this),this.dprCallback=null,this.metrics={w:0,h:0,dpr:1}}subscribe(e){this.listeners.add(e),e(),this.listeners.size===1&&this.attachWindowListeners()}unsubscribe(e){this.listeners.delete(e),this.listeners.size===0&&this.detachWindowListeners()}watchCanvas(e){const t=()=>{const i=M(e);this.metrics=i};this.watchedCanvases.set(e,t),this.subscribe(t)}unwatchCanvas(e){const t=this.watchedCanvases.get(e);t&&(this.unsubscribe(t),this.watchedCanvases.delete(e))}trigger(){this.listeners.forEach(e=>e())}attachWindowListeners(){window.addEventListener("resize",this.boundTrigger),this.addDprListener()}detachWindowListeners(){var e;window.removeEventListener("resize",this.boundTrigger),this.dprCallback&&((e=this.mediaQuery)==null||e.removeEventListener("change",this.dprCallback)),this.mediaQuery=null,this.dprCallback=null}addDprListener(){var e;this.dprCallback&&((e=this.mediaQuery)==null||e.removeEventListener("change",this.dprCallback)),this.mediaQuery=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this.dprCallback=()=>{this.boundTrigger(),this.addDprListener()},this.mediaQuery.addEventListener("change",this.dprCallback,{once:!0})}get cssWidth(){return this.metrics.w}get cssHeight(){return this.metrics.h}get dpr(){return this.metrics.dpr}}const v=new B,k=["#FFD1DC","#B5EAD7","#C7CEEA","#FFDAC1","#E2F0CB"],O={colors:k},F=50,D=1.2,T=.5,f=O.colors,P=f[2],N="#222";localStorage.getItem("logLevel");class y{constructor(e){this.ns=e}out(e,...t){}debug(...e){this.out("debug",...e)}info(...e){this.out("info",...e)}warn(...e){this.out("warn",...e)}error(...e){this.out("error",...e)}}const z=new y("SM");class W{constructor(){this.states=new Map}add(e,t){return this.states.set(e,t),this}change(e){var t,i,s,r;z.info("â†’ change",{from:this.currentName,to:e}),(i=(t=this.current)==null?void 0:t.exit)==null||i.call(t),this.current=this.states.get(e),this.currentName=e,(r=(s=this.current)==null?void 0:s.enter)==null||r.call(s)}update(e){var t,i;(i=(t=this.current)==null?void 0:t.update)==null||i.call(t,e)}get currentStateName(){return this.currentName}}function I(n,e){const t=()=>n.change("play");function i(){const{width:s,height:r}=e.canvas;e.fillStyle=P,e.fillRect(0,0,s,r),e.fillStyle=N,e.textAlign="center",e.font="32px sans-serif",e.fillText("Tap to Start",s/2,r/2)}return{enter(){v.subscribe(i),e.canvas.addEventListener("pointerdown",t)},update(){},exit(){v.unsubscribe(i),e.canvas.removeEventListener("pointerdown",t)}}}const L=new y("Bubble");class U{constructor(e,t,i){this.x=e,this.y=t,this.color=i,this.active=!0,this.speed=.2,L.debug("spawn",{x:this.x.toFixed(2),color:i})}pop(){L.info("pop!"),this.active=!1}step(e){this.y-=this.speed*e,this.y<-.05&&(this.active=!1)}contains(e,t,i,s){if(!this.active)return!1;const r=this.x*i,a=this.y*s,c=e-r,l=t-a,d=c*c+l*l,o=F;return d<=o*o}}function p(n){const{clientWidth:e,clientHeight:t}=n;return{w:e,h:t}}class _{constructor(){}update(e){}draw(e){const{w:t,h:i}=p(e.canvas);e.fillStyle=P,e.fillRect(0,0,t,i)}}class Q{render(e,t){e.save(),e.beginPath();const{w:i,h:s}=p(e.canvas);e.arc(t.x*i,t.y*s,F,0,Math.PI*2),e.fillStyle=t.color,e.globalAlpha=T,e.fill(),e.restore()}}const h=new y("Play");let u=0,w=0;const q=()=>f.length===0?"#FFFFFF":f[Math.floor(Math.random()*f.length)]??"#FFFFFF";function H(n){let e=[],t=0;const i=new Q,s=new _,r=a=>{const c=n.canvas.getBoundingClientRect(),l=a.clientX-c.left,d=a.clientY-c.top,{w:o,h:A}=p(n.canvas);for(let b=e.length-1;b>=0;b--){const m=e[b];if(m&&m.contains(l,d,o,A)){m.pop();break}}};return{update(a){const c=a;a=Math.min(c,.1);const{w:l,h:d}=p(n.canvas);if(n.clearRect(0,0,l,d),u+=c,w++,u>=1){const o=Math.round(w/u);localStorage.getItem("logLevel")==="debug"&&h.debug("fps",o),u=0,w=0}if(t-=a,t<=0){const o=new U(Math.random(),1,q());e.push(o),h.debug("spawned bubble",e.length),t=D}e.some(o=>!o.active)&&(e=e.filter(o=>o.active)),s.update(a),e.forEach(o=>o.step(a)),s.draw(n),e.forEach(o=>i.render(n,o))},enter(){h.info("Play screen entered"),n.canvas.addEventListener("pointerdown",r)},exit(){h.info("Play screen exited"),n.canvas.removeEventListener("pointerdown",r),e=[]}}}const S=document.querySelector("#game"),C=S.getContext("2d");v.watchCanvas(S);const g=new W;g.add("menu",I(g,C)).add("play",H(C));g.change("menu");let E=performance.now();function R(n){const e=(n-E)/1e3;E=n,g.update(e),requestAnimationFrame(R)}requestAnimationFrame(R);
