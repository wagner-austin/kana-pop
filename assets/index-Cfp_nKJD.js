(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function D(s){const e=window.devicePixelRatio||1,{clientWidth:t,clientHeight:n}=s;return s.width=Math.floor(t*e),s.height=Math.floor(n*e),{w:t,h:n,dpr:e}}class N{constructor(){this.listeners=new Set,this.watchedCanvases=new Map,this.mediaQuery=null,this.boundTrigger=this.trigger.bind(this),this.dprCallback=null,this.metrics={w:0,h:0,dpr:1}}subscribe(e){this.listeners.add(e),e(),this.listeners.size===1&&this.attachWindowListeners()}unsubscribe(e){this.listeners.delete(e),this.listeners.size===0&&this.detachWindowListeners()}watchCanvas(e){const t=()=>{const n=D(e);this.metrics=n};this.watchedCanvases.set(e,t),this.subscribe(t)}unwatchCanvas(e){const t=this.watchedCanvases.get(e);t&&(this.unsubscribe(t),this.watchedCanvases.delete(e))}trigger(){this.listeners.forEach(e=>e())}attachWindowListeners(){window.addEventListener("resize",this.boundTrigger),this.addDprListener()}detachWindowListeners(){var e;window.removeEventListener("resize",this.boundTrigger),this.dprCallback&&((e=this.mediaQuery)==null||e.removeEventListener("change",this.dprCallback)),this.mediaQuery=null,this.dprCallback=null}addDprListener(){var e;this.dprCallback&&((e=this.mediaQuery)==null||e.removeEventListener("change",this.dprCallback)),this.mediaQuery=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this.dprCallback=()=>{this.boundTrigger(),this.addDprListener()},this.mediaQuery.addEventListener("change",this.dprCallback,{once:!0})}get cssWidth(){return this.metrics.w}get cssHeight(){return this.metrics.h}get dpr(){return this.metrics.dpr}}const h=new N,T=["#FFD1DC","#B5EAD7","#C7CEEA","#FFDAC1","#E2F0CB"],B={colors:T},H=1.2,z=.5,w=B.colors,R=w[2],Q="#222";function S(){const s=h.cssWidth||window.innerWidth,e=h.cssHeight||window.innerHeight;return Math.min(s,e)*.06}localStorage.getItem("logLevel");class L{constructor(e){this.ns=e}out(e,...t){}debug(...e){this.out("debug",...e)}info(...e){this.out("info",...e)}warn(...e){this.out("warn",...e)}error(...e){this.out("error",...e)}}const _=new L("SM");class q{constructor(){this.states=new Map}add(e,t){return this.states.set(e,t),this}change(e){var t,n,i,r;_.info("â†’ change",{from:this.currentName,to:e}),(n=(t=this.current)==null?void 0:t.exit)==null||n.call(t),this.current=this.states.get(e),this.currentName=e,(r=(i=this.current)==null?void 0:i.enter)==null||r.call(i)}update(e){var t,n;(n=(t=this.current)==null?void 0:t.update)==null||n.call(t,e)}get currentStateName(){return this.currentName}}function f(s){const{clientWidth:e,clientHeight:t}=s;return{w:e,h:t}}function M(s){const e=window.devicePixelRatio||1;s.setTransform(1,0,0,1,0,0),s.scale(e,e)}function I(s,e){const t=()=>s.change("play");function n(){M(e);const{w:i,h:r}=f(e.canvas);e.fillStyle=R,e.fillRect(0,0,i,r),e.fillStyle=Q,e.textAlign="center",e.font="32px sans-serif",e.fillText("Tap to Start",i/2,r/2)}return{enter(){h.subscribe(n),e.canvas.addEventListener("pointerdown",t)},update(){n()},exit(){h.unsubscribe(n),e.canvas.removeEventListener("pointerdown",t)}}}const F=new L("Bubble");class U{constructor(e,t,n){this.x=e,this.y=t,this.color=n,this.active=!0,this.speed=.2,F.debug("spawn",{x:this.x.toFixed(2),color:n})}pop(){F.info("pop!"),this.active=!1}step(e){this.y-=this.speed*e,this.y<-.05&&(this.active=!1)}contains(e,t,n,i){if(!this.active)return!1;const r=this.x*n,l=this.y*i,d=e-r,u=t-l,a=d*d+u*u,c=S();return a<=c*c}}class X{constructor(){}update(e){}draw(e){const{w:t,h:n}=f(e.canvas);e.fillStyle=R,e.fillRect(0,0,t,n)}}class ${render(e,t){e.save(),e.beginPath();const{w:n,h:i}=f(e.canvas);e.arc(t.x*n,t.y*i,S(),0,Math.PI*2),e.fillStyle=t.color,e.globalAlpha=z,e.fill(),e.restore()}}const g=new L("Play");let b=0,C=0;const K=()=>w.length===0?"#FFFFFF":w[Math.floor(Math.random()*w.length)]??"#FFFFFF";function Y(s){let e=[],t=s.canvas.clientWidth,n=s.canvas.clientHeight,i=0;const r=new $,l=new X,d=()=>{const{w:a,h:c}=f(s.canvas);if(t===0||n===0){t=a,n=c;return}const o=a/t,p=c/n;if(!Number.isFinite(o)||o===0||!Number.isFinite(p)||p===0){t=a,n=c;return}t=a,n=c},u=a=>{const c=s.canvas.getBoundingClientRect(),o=a.clientX-c.left,p=a.clientY-c.top,{w:k,h:O}=f(s.canvas);for(let v=e.length-1;v>=0;v--){const y=e[v];if(y&&y.contains(o,p,k,O)){y.pop();break}}};return{update(a){M(s);const c=a;if(a=Math.min(c,.1),b+=c,C++,b>=1){const o=Math.round(C/b);localStorage.getItem("logLevel")==="debug"&&g.debug("fps",o),b=0,C=0}if(i-=a,i<=0){const o=new U(Math.random(),1,K());e.push(o),g.debug("spawned bubble",e.length),i=H}e.some(o=>!o.active)&&(e=e.filter(o=>o.active)),l.update(a),e.forEach(o=>o.step(a)),l.draw(s),e.forEach(o=>r.render(s,o))},enter(){g.info("Play screen entered"),h.subscribe(d),d(),s.canvas.addEventListener("pointerdown",u)},exit(){g.info("Play screen exited"),h.unsubscribe(d),s.canvas.removeEventListener("pointerdown",u),e=[]}}}const A=document.querySelector("#game"),E=A.getContext("2d");h.watchCanvas(A);const m=new q;m.add("menu",I(m,E)).add("play",Y(E));m.change("menu");let P=performance.now();function W(s){const e=(s-P)/1e3;P=s,m.update(e),requestAnimationFrame(W)}requestAnimationFrame(W);
